/*
 * This file was generated by the Gradle 'init' task.
 */

plugins {
    id 'java'
    id 'application'
    id 'maven-publish'
    id "org.jetbrains.kotlin.jvm" version "1.6.21"
    id "idea"
    id "com.github.gradle-lean" version "0.1.2"
}

ext {
    javaMainClass = "com.keithmackay.api.Main"
}

application {
    mainClassName = javaMainClass
}

repositories {
    mavenLocal()
    mavenCentral()
}

dependencies {
    implementation 'com.google.guava:guava:31.1-jre'
    implementation 'org.jetbrains.kotlin:kotlin-reflect:1.6.21'
    implementation 'org.eclipse.jetty:jetty-nosql:9.4.20.v20190813'
    implementation 'com.google.code.gson:gson:2.8.6'
    implementation 'org.mongodb:mongo-java-driver:3.11.0'
    implementation 'org.jongo:jongo:1.4.0'
    implementation 'commons-io:commons-io:2.6'
    implementation 'org.mindrot:jbcrypt:0.4'
    implementation 'com.sendgrid:sendgrid-java:4.4.1'
    implementation 'org.apache.logging.log4j:log4j-api:2.17.2'
    implementation 'org.apache.logging.log4j:log4j-core:2.17.2'
    implementation 'org.apache.logging.log4j:log4j-slf4j-impl:2.17.2'
    implementation 'org.aspectj:aspectjweaver:1.9.1'
    implementation 'aopalliance:aopalliance:1.0'
    implementation 'javax.xml.parsers:jaxp-api:1.4.5'
    implementation 'com.sun.mail:javax.mail:1.6.2'
    implementation 'com.google.inject:guice:5.1.0'
    implementation 'com.google.inject.extensions:guice-assistedinject:5.1.0'
    implementation 'io.javalin:javalin:4.6.0'
    implementation 'io.micrometer:micrometer-core:1.2.0'
    implementation 'org.mongodb:bson:3.11.0'
    implementation 'org.dom4j:dom4j:2.1.1'
    implementation 'com.nixxcode.jvmbrotli:jvmbrotli:0.2.0'
    implementation 'org.quartz-scheduler:quartz:2.3.2'
    implementation 'joda-time:joda-time:2.9.4'
    implementation 'org.postgresql:postgresql:42.2.12'
    implementation group: 'com.squareup.okhttp3', name: 'okhttp', version: '4.7.2'
    implementation 'org.hibernate:hibernate-core:5.4.15.Final'
    implementation 'org.twitter4j:twitter4j-core:4.0.7'
    testImplementation 'org.jetbrains.kotlin:kotlin-test-junit:1.6.21'
    testImplementation 'org.jetbrains.kotlin:kotlin-test-common:1.6.21'
    testImplementation 'org.jetbrains.kotlin:kotlin-test-annotations-common:1.6.21'

    implementation 'org.dom4j:dom4j:2.1.1'
    implementation 'org.jetbrains:annotations:19.0.0'
    implementation 'javax.xml.parsers:jaxp-api:1.4.5'
    // https://mvnrepository.com/artifact/org.aspectj/aspectjweaver
    implementation 'org.aspectj:aspectjweaver:1.9.5'
    implementation group: 'com.squareup.okhttp3', name: 'okhttp', version: '4.7.2'
    implementation 'aopalliance:aopalliance:1.0'

    testCompileOnly 'org.projectlombok:lombok:1.18.22'
    testAnnotationProcessor 'org.projectlombok:lombok:1.18.22'
    compileOnly 'org.projectlombok:lombok:1.18.22'
    annotationProcessor 'org.projectlombok:lombok:1.18.22'

    implementation 'org.jetbrains.kotlin:kotlin-gradle-plugin:1.4.21'

    implementation 'org.brotli:parent:0.1.2'
    // https://mvnrepository.com/artifact/org.json/json
    implementation 'org.json:json:20211205'

}

group = 'com.keithmackay.api'
version = '1.0.0'
sourceCompatibility = '17'
targetCompatibility = '17'

//create a single Jar with all dependencies
task makeJar(type: Jar) {
    duplicatesStrategy = DuplicatesStrategy.EXCLUDE

    manifest {
        attributes 'Implementation-Title': 'Complete Jar',
                'Implementation-Version': archiveVersion,
                'Main-Class': 'com.keithmackay.api.Main'
    }
    archivesBaseName = project.name + '-all'
    from {
        configurations.runtimeClasspath.collect {
            logger.info(it.toString())
            it.isDirectory() ? it : zipTree(it)
        }
    }
    with jar
}

task getDeps(type: Copy) {
    from sourceSets.main.runtimeClasspath
    into 'runtime/'
}
compileKotlin {
    kotlinOptions {
        jvmTarget = "17"
    }
}
compileTestKotlin {
    kotlinOptions {
        jvmTarget = "17"
    }
}
